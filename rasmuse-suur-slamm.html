<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rasmuse Suur Slämm</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 1em;
      background: #f0f0f0;
    }
    h1 {
      text-align: center;
      margin-bottom: 1em;
    }
    #results {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }
    .comp-box {
      position: relative;
      background: url('assets/beach.jpg') center/cover no-repeat;
      border-radius: 12px;
      overflow: hidden;
      padding: 1em;
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .comp-title {
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 0.5em;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }
    .podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 0.5em;
    }
    .podium > div {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      flex-shrink: 0;
      border-radius: 6px;
    }
    .podium .first {
      width: 30%;
      height: 150px;
      background: rgba(255,215,0,0.9);
    }
    .podium .second {
      width: 25%;
      height: 120px;
      background: rgba(192,192,192,0.9);
    }
    .podium .third {
      width: 25%;
      height: 100px;
      background: rgba(205,127,50,0.9);
    }
    .podium div .team-label {
      position: absolute;
      top: 8px;
      width: 100%;
      text-align: center;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    }
    .podium img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    /* Position the three images in a triangle for each podium column */
    .first img:nth-child(1) { position:absolute; bottom: 10px; left:50%; transform: translateX(-50%); }
    .first img:nth-child(2) { position:absolute; bottom: 60px; left:40%; transform: translateX(-50%); }
    .first img:nth-child(3) { position:absolute; bottom: 60px; left:60%; transform: translateX(-50%); }

    .second img:nth-child(1) { position:absolute; bottom: 10px; left:50%; transform: translateX(-50%); }
    .second img:nth-child(2) { position:absolute; bottom: 50px; left:35%; transform: translateX(-50%); }
    .second img:nth-child(3) { position:absolute; bottom: 50px; left:65%; transform: translateX(-50%); }

    .third img:nth-child(1) { position:absolute; bottom: 10px; left:50%; transform: translateX(-50%); }
    .third img:nth-child(2) { position:absolute; bottom: 50px; left:40%; transform: translateX(-50%); }
    .third img:nth-child(3) { position:absolute; bottom: 50px; left:60%; transform: translateX(-50%); }

    /* Responsive: stack podiums vertically on narrow screens */
    @media (max-width: 600px) {
      .podium {
        flex-direction: column;
        gap: 0.75em;
      }
      .podium .second,
      .podium .first,
      .podium .third {
        width: 80% !important;
        margin: auto;
      }
    }
  </style>
</head>
<body>
  <h1>Competition Results</h1>
  <div id="results">Loading…</div>
  <script>
    fetch('/data/results.json?t=' + Date.now(), { cache: 'no-store' })
      .then(r => { if (!r.ok) throw new Error(r.statusText); return r.json(); })
      .then(json => {
        const arr = Array.isArray(json) ? json : [json];
        const container = document.getElementById('results');
        container.innerHTML = '';
        arr.forEach(comp => {
          const box = document.createElement('div');
          box.className = 'comp-box';
          // Build the HTML for the three podium columns:
          box.innerHTML = `
            <div class="comp-title">${comp.competitionName}</div>
            <div class="podium">
              <div class="second">
                <div class="team-label">${comp.teams[1]?.teamName||''}</div>
                ${renderImgs(comp.teams[1]?.players||[])}
              </div>
              <div class="first">
                <div class="team-label">${comp.teams[0]?.teamName||''}</div>
                ${renderImgs(comp.teams[0]?.players||[])}
              </div>
              <div class="third">
                <div class="team-label">${comp.teams[2]?.teamName||''}</div>
                ${renderImgs(comp.teams[2]?.players||[])}
              </div>
            </div>`;
          container.appendChild(box);
        });
      })
      .catch(err => {
        document.getElementById('results').textContent =
          'Error loading results: ' + err;
        console.error(err);
      });
    function slugify(name) {
        return name
          // normalize accents to decomposed form, then strip diacritics
          .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, '-')   // non-alphanumeric → hyphen
          .replace(/^-+|-+$/g, '');      // trim leading/trailing hyphens
    }

    function renderImgs(players) {
      return players.slice(0,3).map(p => {
        const file = slugify(p.name) + '.png';  // or `.png` if needed
        const url  = `/assets/players/${file}`;
        return `<img src="${url}" alt="${p.name}" title="${p.name}"
               onerror="this.src='/assets/players/placeholder.png'"/>`;
      }).join('');
    }
  </script>
</body>
</html>
